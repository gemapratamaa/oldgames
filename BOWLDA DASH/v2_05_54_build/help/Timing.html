<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<link type="text/css" rel="stylesheet" media="all" href="css/base.css" />
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1252">
	<TITLE>Timing</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice 4.1.3  (Win32)">
	<META NAME="CREATED" CONTENT="0;0">
	<META NAME="CHANGED" CONTENT="0;0">
	<SCRIPT SRC="js/jquery.min.js"></SCRIPT>
	<SCRIPT>
		$(document).ready(function()
		{
			if (top.frames.length == 0)
			{
				var sTopicUrl = top.location.href.substring(top.location.href.lastIndexOf("/") + 1, top.location.href.length);
				top.location.href = "DxWnd.html?" + sTopicUrl;
			}
		});
	
	</SCRIPT>
	<STYLE TYPE="text/css">
	<!--
		P { margin-bottom: 0cm; border: none; padding: 0cm; color: #000000; font-family: "Arial", "Helvetica", sans-serif; font-size: 10pt; font-style: normal; font-weight: normal; text-align: left; text-decoration: none }
		TD P { margin-bottom: 0cm; border: none; padding: 0cm; color: #000000; font-family: "Arial", "Helvetica", sans-serif; font-size: 10pt; font-style: normal; font-weight: normal; text-align: left; text-decoration: none }
		P.rvps2 { font-family: "Arial", "Helvetica", sans-serif; font-size: 10pt; font-style: normal; font-weight: normal }
		H3 { color: #000000 }
		H3.cjk { font-family: "SimSun" }
		H3.ctl { font-family: "Mangal" }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" TEXT="#000000" BGCOLOR="#ffffff" DIR="LTR" STYLE="border: none; padding: 0cm">
<DIV ID="topic_content" DIR="LTR">
	<P CLASS="rvps2" STYLE="margin-bottom: 0.5cm"><IMG SRC="lib/dxwnd_configuration_timing2.png" NAME="grafiikka4" ALIGN=BOTTOM WIDTH=503 HEIGHT=555 BORDER=0></P>
	<H3 CLASS="western">Frame per Second</H3>
	<TABLE WIDTH=100% BORDER=1 CELLPADDING=2 CELLSPACING=2>
		<TR VALIGN=TOP>
			<TD WIDTH=124>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Limit</P>
			</TD>
			<TD WIDTH=119>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">LIMITFPS</P>
			</TD>
			<TD WIDTH=1294>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Introduces a
				configurable delay between &nbsp;screen refresh operations, so
				that the FPS is limited accordingly.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=124>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Skip</P>
			</TD>
			<TD WIDTH=119>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">SKIPFPS</P>
			</TD>
			<TD WIDTH=1294>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Introduces no
				delay in the screen operations, but skips several screen updates
				so that the actual FPS value is &nbsp;limited without the program
				noticing it.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=124>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">delay (msec)</P>
			</TD>
			<TD WIDTH=119></TD>
			<TD WIDTH=1294>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Sets the
				delay time, expressed in milliseconds, for both the &quot;Limit&quot;
				(LIMITFPS) and &quot;Skip&quot; (SKIPFPS) options. To be noted
				that the FPS is related to the delay by the formula FPS =
				1000/Delay or, the other way around, Delay = 1000/FPS. So if, for
				example, you desire an FPS not greater than 50, the corresponding
				value to get this effect is Delay = 20msec. Note that a greater
				delay means a slower frame rate.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=124>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Limit Flip only
				</P>
			</TD>
			<TD WIDTH=119>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">LIMITFLIPONLY</P>
			</TD>
			<TD WIDTH=1294>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">When set, both the FPS
				limitation and FPS count take in consideration only the Flip operations,
				ignoring any other operation like Blt to primary surface.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=124>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Limit D3D
				BeginScene</P>
			</TD>
			<TD WIDTH=119>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">LIMITBEGINSCENE</P>
			</TD>
			<TD WIDTH=1294>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Flag to limit
				FPS in D3D games. Note: If used together with the &quot;limit&quot;
				flag you will get a doubled delay.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=124>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Limit DIB
				operations</P>
			</TD>
			<TD WIDTH=119>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">LIMITDIBOPERATIONS</P>
			</TD>
			<TD WIDTH=1294>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Flag to apply delay 
				to GDI32 DIB operations only. Helps improving "Rubik's Games" animations.</P>
			</TD>
		</TR>
	</TABLE>
	<P CLASS="rvps2" STYLE="margin-bottom: 0.5cm">Limiting the FPS may
	also help old games that suffer from strange side effects from
	running too fast. For example: Mechwarrior 3 jumping APC bug can be
	fixed by limiting the FPS to 30 or below. Another game that benefits
	from FPS limit is the 1999 release of Outcast (Twon-ha riding bug).
	Yet another is BladeRunner (shooting range bug).</P>
	<P><BR>
	</P>
	<HR>
	<H3 CLASS="western">System speed</H3>
	<TABLE WIDTH=100% BORDER=1 CELLPADDING=2 CELLSPACING=2>
		<TR VALIGN=TOP>
			<TD WIDTH=112>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">CPU slow down</P>
			</TD>
			<TD WIDTH=99>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">CPUSLOWDOWN</P>
			</TD>
			<TD WIDTH=1326>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Reduces a
				program's CPU usage by suspending and resuming all of its threads
				according to the specified ratio. Since the minimum timing
				resolution that the system can use for this operation is 1ms,
				(1/1000th of a second), high ratios may make the game appear
				choppy. This flag doesn't suspend high-priority threads.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=112>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">CPU max usage</P>
			</TD>
			<TD WIDTH=99>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">CPUMAXUSAGE</P>
			</TD>
			<TD WIDTH=1326>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Same as
				CPUSLOWDOWN, but operates more selectively. This flag only
				suspends process threads that are consuming more CPU than the
				selected ratio. This option can't be set at the same time as
				CPUSLOWDOWN.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=112>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Ratio</P>
			</TD>
			<TD WIDTH=99></TD>
			<TD WIDTH=1326>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Allows you to
				set a ratio for the slowdown used by the above flags. For
				example, a value of 2 will produce a ratio of 1:2, suspending the
				program for 1ms and then running it for 2ms, reducing that
				program's CPU usage by 33%.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=112>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Use precise
				timing</P>
			</TD>
			<TD WIDTH=99>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">PRECISETIMING</P>
			</TD>
			<TD WIDTH=1326>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Use precise
				timing through the QueryPerformanceCounter system call. Produces
				a smoother slow down.</P>
			</TD>
		</TR>
	</TABLE>
	<P><BR>
	</P>
	<HR>
	<H3 CLASS="western">Time Stretching</H3>
	<TABLE WIDTH=100% BORDER=1 CELLPADDING=2 CELLSPACING=2>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Time
				Stretching &ndash; initial</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">TIMESTRETCH</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">If this
				option is checked, DxWnd tries to emulate an accelerated (xn) or
				decelerated (:n) time flow. The value set in the listbox is the
				initial value, that can be altered by means of the time control
				slider in the time panel (see <A HREF="TimeSlider.html">Time
				Slider</A>). When checked, DxWnd stretches time in the timing API
				(such as with GetSystemTime()), the query performance APIs, and
				the Sleep APIs, which are the most common ways to control a
				program's timing. 
				</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Show time
				stretch</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">SHOWTIMESTRETCH</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">When checked,
				the time stretch ratio is drawn as an overlay in a corner of the
				screen, sometimes moving to other corners when it is updated.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Fine time
				adjust</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">FINETIMING</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">When checked,
				the time stretch ratio shows ticks in finer increments, switching
				from a 50% change with each tick to a 10% change with each tick.
				This limits the range to 0.5x-2.0x but allows for finer timing
				control.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Enable Time
				Freeze</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">ENABLETIMEFREEZE</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">See <A HREF="GlobalSettings.html">Function
				Keys</A>.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Intercept
				RDTSC opcode</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">INTERCEPTRDTSC</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Program
				timing is usually determined by system calls that can be easily
				and safely hooked to stretch the flow of time. There is one
				possible exception, however: when the program embeds in its
				assembly the RDTSC assembly instruction opcodes that directly
				access the hardware clock. This timing value can still be
				intercepted and manipulated, but using a more delicate technique
				that searches for the assembly code and replaces it with specific
				calls. This is why I preferred to make this option available with
				a dedicated flag to be activated when necessary. The flag should
				be set whenever adjusting the time stretching option does not
				alter the time flow.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Stretch Performance Frequency</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">STRETCHPERFREQUENCY</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Despite the fact that Microsoft
				documents clearly state that the QueryPerformanceFrequency returns a constant value
				that could be cached on a given machine, some games (es. "Gun Wings") do not rely on 
				the system clock and repeatedly use QueryPerformanceFrequency. The flag alters
				the returned value scaling it by the time stretching factor.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Stretch
				timers</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">STRETCHTIMERS</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">When checked,
				the window timers are stretched, namely the user32.dll timers set
				by SetTimer and the multimedia timers in winmm.dll set by
				timeSetEvent().</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Normalize
				Performance Counter</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">NORMALIZEPERFCOUNT</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Normalizes
				the system performance counter, simulating a clock speed of 1MHz.
				Some old games assume that this is the correct clock speed, and
				produce speed problems without this flag. This flag gives these
				old games the clock speed they depend on to run properly. Don't
				use this flag unless you are experiencing speed issues.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Suspend time
				stretch in movies</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">SUSPENDTIMESTRETCH</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Suspend time
				stretch flag to play movies at normal speed and avoid audio
				shuttering (implemented for bink and smack videos only so far).</P>
			</TD>
		</TR>
	</TABLE>
	<P><BR>
	</P>
	<HR>
	<H3 CLASS="western">CPU Optimization</H3>
	<TABLE WIDTH=100% BORDER=1 CELLPADDING=2 CELLSPACING=2>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Slow down
				mouse polling</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">SLOW</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Some old
				programs have this bad habit of continuously looping through the
				mouse status polling with no delay, hogging 100% of CPU
				resources. This flag introduces a minimal and unnoticeable delay
				between mouse polls, saving CPU resources.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Slow down
				window polling</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">SLOWWINPOLLING</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Reduces CPU
				load in some programs.</P>
			</TD>
		</TR>
	</TABLE>


	<HR>
	<H3 CLASS="western">VSync Tweaks</H3>
	<TABLE WIDTH=100% BORDER=1 CELLPADDING=2 CELLSPACING=2>
		<TR VALIGN=TOP>
			<TD WIDTH=188>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Kill D3D vSync</P>
			</TD>
			<TD WIDTH=148>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">KILLVSYNC</P>
			</TD>
			<TD WIDTH=1201>
				<P CLASS="rvps2" STYLE="border: none; padding: 0cm">Fast-pacing games may
				rely on the video vertical synchronization to control the game speed, making
				it easy to delay the frame rate, but making it hard to speed it up.
				The flag forces no vertical synchronization in D3D operations so that 
				the FPS value could grow indefinitely.<BR>
				Beware: this tweak is supported from D3D9 and higher, D3D8 does not support this method.</P>
			</TD>
		</TR>
	</TABLE>
	<DIV ID="topic_footer" DIR="LTR">
		<P STYLE="margin-bottom: 0.5cm"><BR><BR>
		</P>
	</DIV>
</DIV>
</BODY>
</HTML>